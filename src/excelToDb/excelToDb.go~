package main

import (
  "database/sql"
  "fmt"
	"github.com/tealeg/xlsx"

  _ "github.com/lib/pq"
)

const (
  host     = "localhost"
  port     = 5432
  user     = "postgres"
  password = "qburst"
  dbname   = "my_db"
)

func main() {
  psqlInfo := fmt.Sprintf("host=%s port=%d user=%s "+
    "password=%s dbname=%s sslmode=disable",
    host, port, user, password, dbname)
  db, err := sql.Open("postgres", psqlInfo)
  if err != nil {
	fmt.Println("*******",err);
    panic(err)
  }
  defer db.Close()

  sqlStatement := `
INSERT INTO users (name, age, email)
VALUES ($1, $2, $3)`
	
	excelFile := "sample.xlsx"
    xlFile, err := xlsx.OpenFile(excelFile)
    if err != nil {
	fmt.Println(">>>>>>>>",err);
        fmt.Println("Error")
    }
    for _, sheet := range xlFile.Sheets {
        for rowIndex, row := range sheet.Rows {
					if rowIndex == 0 {
						continue
					}
					fmt.Println("Inserting row\n")
					currentRow := make([]string, 3)
					for i, cell := range row.Cells {
                text := cell.String()
								currentRow[i] = text
            }
						_, err = db.Exec(sqlStatement, currentRow[0], currentRow[1], currentRow[2])
						if err != nil {
    					fmt.Println("Error:", err)
  					} else {
						  fmt.Println("\n")
						}
        }
    }
}


